<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Order List</title>
    <link rel="shortcut icon" href="../static/icon/icon.jpg" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
          integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"
            integrity="sha256-JLmknTdUZeZZ267LP9qB+/DT7tvxOOKctSKeUC2KT6E=" crossorigin="anonymous"></script>
</head>

<body>
<div>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
        <img alt="shop.png" height="35" src="/static/icon/shop.png">
        <h5 class="my-0 mr-md-auto font-weight-normal"><a href="home.html">ISHOPPING</a></h5>
        <a href="home.html" class="btn btn-outline-primary">Home</a>
        <a href="sign_in.html" class="btn btn-outline-primary ml-3">Sign In</a>
        <a href="register.html" class="btn btn-outline-primary ml-3">Register</a>
        <a href="commodity_search.html" class="btn btn-outline-primary ml-3">Search</a>
        <a href="commodity_add.html" class="btn btn-outline-primary ml-3">Commodity Add</a>
    </div>
    <div id="orderList">
        <table v-if="hasOrder">
            <thead>
                <th>order id</th>
                <th>total price</th>
                <th>delivery</th>
                <!-- <th>status</th> -->
            </thead>
            <tbody v-for="o in orders">
                <td>{{o.order_id}}</td>
                <td>{{o.total_price}}</td>
                <td>
                    <p id="deliveryid" v-if="orderSended(o.delivery_id)">Deliveried</p>
                    <button id="delivery" v-on:click="sendOrder(o.order_id)" v-else>Delivery</button>
                </td>
                <!-- <td id="status" >
                    <p v-if="orderSended(o.delivery_id)">sended</p>
                    <p v-if="orderReceived(o.delivery_id)">received</p>
                    <p v-if="orderPayed(o.delivery_id) && !orderSended(o.delivery_id)">payed</p>
                    <p v-if="orderUnpayed(o.delivery_id)">unpayed</p>
                </td> -->
            </tbody>
        </table>
        <h1 id="noOrder" v-else>Order list is empty!</h1>
    </div>
    <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
            <div class="col-12 col-md">
                <h5>Copyright&copy;2021</h5>
                <p>
                    <a target="_blank"><i class="fa fa-leaf"></i> Blog</a> -
                    <a target="_blank"><i class="fa fa-github"></i> Github</a> -
                    <a target="_blank"><i class="fa fa-question"></i> Help</a>
                </p>
            </div>
        </div>
    </footer>
</div>
    <script>
        new Vue({
            el: '#orderList',
            data:{
                res:12,
                total: 0,
                hasOrder: false,
                orders:[
                    //example
                    // {
                    //     order_id: 1,
                    //     total_price:100,
                    //     delivery_id:-1     //>=0 deliveried  <0 not
                    // },
                    // {
                    //     order_id: 2,
                    //     total_price:200,
                    //     delivery_id:0
                    // },
                    // {
                    //     order_id: 3,
                    //     total_price:300,
                    //     delivery_id:-1
                    // }
                ]
            },
            methods:{
                sendOrder: function(id){
                    axios.defaults.headers.common = {Authorization:true}
                    axios({
                        method: 'post',
                        url: 'http://localhost:7001/api/seller/order_delivery',
                        data:{
                            'order_id':id
                    }}).then(function(res){
                        console.log(id+" Deliveried")
                        if(res.data.code == 0){
                            var or = []
                            for(var ol in this.orders){
                                if(ol.order_id == id){
                                    // ol.delivery_id = res.data.data.delivery_id
                                    ol.delivery_id = 0
                                }
                                or.push(ol)
                            }
                            orders = or
                            return orders
                        }else{
                            console.log(res.data.msg)
                        }
                        
                    })
                    .catch(function (error) { 
                        console.log(error);
                    })
                },
                orderSended: function(delivery_id){
                    return (delivery_id >= 0)
                }

            },
            mounted(){
                
                axios({
                    'url':'http://localhost:7001/api/seller/order_list?order_status=1',
                    'method': 'get',
                    // 'Access-Control-Allow-Origin': '*',
                    // 'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept',
                    // 'dataType':'JSONP',
                })
                    .then(function(res){
                        console.log(res)
                        this.hasOrder = true
                        if(res.data.code == 0){
                            for(var ol in res.data.data.order_list){
                                ol.delivery_id=-1
                                orders.push(ol)
                            }
                        }else{
                            console.log(res.data.msg)
                        }
                        
                    })
                    .catch(function (error) { 
                        console.log(error)
                        // window.alert(error)
                    });
                    //http://localhost:7001/api/seller/order_list?order_status=2
                axios({
                    'url':'http://localhost:7001/api/seller/order_list?order_status=2',
                    'method':'get',
                })
                    .then(function(res){
                        console.log(res)
                        if(res.data.code == 0){
                            // this.orders.push(res.data.data.order_list)
                            for(var ol in res.data.data.order_list){
                                ol.delivery_id=0
                                orders.push(ol)
                            }
                        }else{
                            console.log(res.data.msg)
                        }
                        
                    })
                    .catch(function (error) { 
                        console.log(error);
                        // window.alert(error)
                    });
            },
        })
    </script>
    <style>
        table{
            margin:auto;
            border:2px solid black;
            text-align: center;
            font-size: 22px;
            width:1000px
        }
        tbody{
            font-size:20px;
        }
        th,td{
            border:1px solid black;
        }
    </style>
</body>
</html>
